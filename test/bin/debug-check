#!/bin/sh

. "$(dirname "$0")/common.sh"

if test $# -ne 1
then
	echo "Usage: $0 path/to/file" >&2
	exit 1
fi

require_env UCC
require_env UCC_TESTDIR

set -e

if test -n "$UCC_VERBOSE"
then set -x
fi

tmp="$UCC_TESTDIR/dbg.$$"

$UCC -g -fno-debug-emit-compdir -S -o- "$1" \
	| awk '/section_begin.*dbg/,/section_end/' \
	> "$tmp"

diff -u "$tmp" "$1".debug
